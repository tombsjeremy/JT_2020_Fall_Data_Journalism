title: "Climate_Data_Group_3"
author: "Sasha Marquez, Audrey Decker, Rona Kobell, Jeremy Tombs, Rayonna Burton"
date: "11/9/2020"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(tidyverse)
library(vembedr)
library(lubridate)
library(janitor)
```

##Background: Why we selected North Dakota

```{r}
#Read in all of the processed data from the Washington Post database
national_year <- read.csv("https://raw.githubusercontent.com/washingtonpost/data-2C-beyond-the-limit-usa/main/data/processed/climdiv_national_year.csv")
county_year <- read.csv("https://raw.githubusercontent.com/washingtonpost/data-2C-beyond-the-limit-usa/main/data/processed/climdiv_county_year.csv")
state_year <- read.csv("https://raw.githubusercontent.com/washingtonpost/data-2C-beyond-the-limit-usa/main/data/processed/climdiv_state_year.csv")
model_county <- read.csv("https://raw.githubusercontent.com/washingtonpost/data-2C-beyond-the-limit-usa/main/data/processed/model_county.csv")
model_state <- read.csv("https://raw.githubusercontent.com/washingtonpost/data-2C-beyond-the-limit-usa/main/data/processed/model_state.csv")
drought_data <- read_csv("data/north_dakota_drought_severity_data.csv")
options(scipen=999)
```

```{r}
#Create new data frame called model_state_ND_only
model_state_ND_only <- model_state %>%
#Filter just for the row of North Dakota data  
  filter (fips == 38) 
```

```{r}
#Create new data frame called model_state_sorted
model_state_sorted <- model_state %>%
#Sort the model_state sheet in descending order by annual average temperature change  
  arrange (desc(Annual))
#North Dakota is the state in the U.S. with the seventh largest rate of annual average temperature change. Each of the states with larger change are confined to one region: New England and the mid-Atlantic. North Dakota stands out as the first state on the list not in that region, but rather much closer to the Pacific coast. Some questions emerge: how does the high rate of temperature change affect crops grown in the state? How does the high rate of temperature change affect the growing season for agriculture in the state? Are there any correlated phenomena (ie. drought, rainfall, weather conditions, etc) that can be observed as a result of the high rate of temperature change? Why is the average annual temperature change in North Dakota more comparable to states in New England rather than other states around North Dakota?
```

```{r}
#Create new data frame called model_county_ND_sorted from the model_county data frame
model_county_ND_sorted <- model_county %>%
#Filter for just North Dakota  
  filter (STNAME == "North Dakota") %>%
#Arrange in descending order by annual average temperature change.  
  arrange (desc(Annual))
#This dataframe arranges counties in North Dakota in descending order by average annual temperature change. The top five counties listed are all in the northernmost part of the state, which poses some questions about what the agriculture is like there, what the terrain is like, what the population and industry is like, and how these are all affected by rising temperatures. Additionally, all top 5 counties have had average annual temperature increases of at least .31 degrees higher than the state average.
```


##Finding 1: Looking at any correlation between increased severe drought areas in North Dakota and increased temperatures in the state.
```{r}
#Create new data frame called drought_data_year_filtered from the original drought_data data frame. 
drought_data_year_filtered <- drought_data %>%
#Using the lubridate package, create a new column called "year." Fill that column with the years from the dates in the "Week" column.  
  mutate(year = year(Week))
```

```{r}
#Create new data frame called ND_only_state_year from the state_year data frame.
ND_only_state_year <- state_year %>%
#Filter for just the North Dakota FIPS code, 38. This creates the same data frame as state_year but includes only the rows pertaining to North Dakota.  
   filter (fips == "38")
```

```{r}
#Create new data frame called yearly_drought_average from the drought_data_year_filtered data frame,
yearly_drought_average <- drought_data_year_filtered %>%
#Clean the column names using the janitor package to remove any dashes and capital letters.  
  clean_names() %>%
#Group the rows by the values in the year column.  
  group_by(year) %>%
#For each drought severity column, find the mean of all the values of the weeks in that year. This way, when there's only one row per year, there will be an average of all 52 weeks' data in the row for the year.
  summarise(none=mean(none),
            d0=mean(d0_d4),
            d1=mean(d1_d4),
            d2=mean(d2_d4),
            d3=mean(d3_d4),
            d4=mean(d4))
```

```{r}
#Create new data frame called yearly_avg_temps_drought from the yearly_drought_average data frame.
yearly_avg_temps_drought <- yearly_drought_average %>%
#Join the ND_only_state_year data frame with the yearly_drought_average data frame. This will combine the two based on the column they have in common, year. It also eliminates any rows of years that are not common between the two data frames. This was important for ND_only_state_year, because the data frame listed every year from 1895, for which we did not have drought data for.
  inner_join(ND_only_state_year)
```

```{r}
#This is just testing out how to graphically represent the data for this finding. 
yearly_avg_temps_drought %>%
  ggplot(aes(year, d0)) +
  geom_bar(stat="identity",
           fill="steelblue",) +
      labs(
       x="Year",
       y="Percentage of the state in drought",
       title="test",
           caption="Source: Drought Data"
           ) +
          geom_text(aes(label=round(2))
                    ,
                    vjust=-.1)
```

```{r}
#This is just testing out how to graphically represent the data for this finding. 
yearly_avg_temps_drought %>%
  ggplot(aes(year, temp)) +
  geom_bar(stat="identity",
           fill="steelblue",) +
      labs(
       x="Year",
       y="Percentage of the state in drought",
       title="test",
           caption="Source: Drought Data"
           ) +
          geom_text(aes(label=round(2))
                    ,
                    vjust=-.1)
```

##Finding 2: Rising temperatures in North Dakota have extended their growing season.

```{r}
#read in growing season data for Fargo, ND
fargo_growing_season <- read_csv("data/processed/fargo_growing_season.csv")
```

```{r}
#Create a new data frame and summarize the data by decade, taking out the min/max and 2020
season_length <- fargo_growing_season %>%
  filter(year != "2020") %>%
  mutate(decade = str_sub(year, start = 1L, end = 3L)) %>%
  mutate(decade = paste0(decade, "0")) %>%
  group_by(decade) %>%
  summarize(season_length = mean(season_length)) %>%
  mutate(season_length = round(season_length, 0)) %>%
  filter(!str_detect(decade, "M"))
#Create a graph below which displays the average number of days in a growing season by decade
season_length %>%
  ggplot(aes(decade, season_length)) +
  geom_bar(stat="identity", fill="steelblue") +
  labs(
    x="Year",
    y="Number of days in growing season",
    title="Average Growing Season Length of North Dakota"
  )
# Taking the fargo_growing_season data frame, we created a chart to show that from 1881 to 2020, there has been a general, upward trend of longer growing seasons. Since there are so many years, we grouped them by decades. The general progression of the data is an increased length of the growing season, which connects to the general trend of warming temperatures. This has had a positive impact on agriculture in ND because farmers have a longer time frame to grow crops. 
```

```{r}
#Created a new data frame for a line plot
fargo_growing_year <- fargo_growing_season %>%
  filter(year != "2020") %>%
  filter(!str_detect(year, "M")) %>%
  mutate(year=as.numeric(year))
#Used function to find an average line
fargo_growing_year %>%
  ggplot() + 
  geom_line(aes(y = season_length, x = year)) +
  geom_smooth(aes(y = season_length, x = year), method = "loess")
  
#In the line plot, we displayed every year throughout the decades. It's clear that there are outliers and the trend isn't straight up. Due to weather fluctuations, there are going to be years that are lower and higher. However, looking at the average line, the growing season in North Dakota has increased. The growing season lengthened during this period by 32 days - over a month. 
```

##Finding 3: Climate change's effect on Native American reservations in North Dakota.

```{r}
#Read in the tribe data.
tribal_procounty_ND <- read_csv("https://raw.githubusercontent.com/RMBJernigan/rmbj_Jour772Data/master/Group%20Project%202/data-2C-beyond-the-limit-usa-main/data/processed/tribal_data.csv")
```

```{r}
#This chart was created to specifically look at the average change of temperature in the counties that have tribes or nations on the land
tribal_county_ND <- model_county_ND_sorted %>%
  filter(CTYNAME %in% c("Sioux County", "Benson County", "Richland County" ,"Sargent County","Grant County","McLean County", " Mountrail County", "Dunn County", "McKenzie County", "Mercer County", "Ward County", "Rolette County" ))
  
  
#CTYNAME == "Sioux County", "Benson County", "Richland County" ,"Sargent County","Grant County","McLean County", " Mountrail County", "Dunn County", "McKenzie County", "Mercer County", "Ward County", "Rolette County")
 
#Display below
tribal_county_ND
```

```{r}
#This a self made chart about the ProPublica data on the climate change of the different counties around the state. It analysis the rises of the different subs of the data. This is before doing an innerjoin
tribal_procounty_ND 
  transform(as.numeric(fips))
```

```{r}
tribal_join_county_ND <- tribal_county_ND  %>%
  inner_join(tribal_procounty_ND)
 
```

##Finding 4: 
```{r}


```